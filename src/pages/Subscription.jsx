// src/pages/Subscription.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import "./Subscription.css";

export default function Subscription() {
  const [userEmail, setUserEmail] = useState("");
  const [plan, setPlan] = useState("premium");
  const [billingCycle, setBillingCycle] = useState("monthly");
  const [nextBillingDate, setNextBillingDate] = useState("");
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Carregar dados do usu√°rio do localStorage
    const email = localStorage.getItem("user_email") || "";
    setUserEmail(email);

    // Simular carregamento de dados da assinatura
    // Em produ√ß√£o, isso viria do Stripe via API
    setTimeout(() => {
      const next = new Date();
      next.setMonth(next.getMonth() + 1);
      setNextBillingDate(next.toLocaleDateString("pt-BR"));
      setLoading(false);
    }, 500);
  }, []);

  const handleManageSubscription = () => {
    // Redirecionar para o portal do cliente do Stripe
    alert("Em produ√ß√£o, isso abrir√° o portal do cliente do Stripe para gerenciar sua assinatura.");
    // window.open("https://billing.stripe.com/p/login/...", "_blank");
  };

  const handleCancelSubscription = () => {
    if (window.confirm("Tem certeza que deseja cancelar sua assinatura? Voc√™ perder√° acesso aos recursos Premium.")) {
      alert("Para cancelar, acesse o portal de gerenciamento de assinatura.");
      handleManageSubscription();
    }
  };

  if (loading) {
    return (
      <div className="subscription-page">
        <div className="subscription-container">
          <div className="loading">Carregando...</div>
        </div>
      </div>
    );
  }

  return (
    <div className="subscription-page">
      <div className="subscription-container">
        {/* Header */}
        <div className="subscription-header">
          <h1>Minha Assinatura</h1>
          <p>Gerencie sua assinatura e prefer√™ncias</p>
        </div>

        {/* Informa√ß√µes do usu√°rio */}
        <section className="subscription-section">
          <h2>üë§ Informa√ß√µes Pessoais</h2>
          <div className="info-grid">
            <div className="info-item">
              <label>E-mail</label>
              <div className="info-value">{userEmail || "N√£o informado"}</div>
            </div>
            <div className="info-item">
              <label>Plano Atual</label>
              <div className="info-value">
                <span className="badge badge-premium">Premium</span>
              </div>
            </div>
            <div className="info-item">
              <label>Status</label>
              <div className="info-value">
                <span className="badge badge-active">Ativo</span>
              </div>
            </div>
            <div className="info-item">
              <label>Membro desde</label>
              <div className="info-value">{new Date().toLocaleDateString("pt-BR")}</div>
            </div>
          </div>
        </section>

        {/* Detalhes da assinatura */}
        <section className="subscription-section">
          <h2>üí≥ Detalhes da Assinatura</h2>
          
          <div className="subscription-card">
            <div className="subscription-card-header">
              <div>
                <h3>Plano Premium</h3>
                <p>Acesso completo a todos os recursos</p>
              </div>
              <div className="subscription-price">
                <span className="price">R$ 90,00</span>
                <span className="period">/m√™s</span>
              </div>
            </div>

            <div className="subscription-details">
              <div className="detail-item">
                <span className="detail-label">Pr√≥xima cobran√ßa:</span>
                <span className="detail-value">{nextBillingDate}</span>
              </div>
              <div className="detail-item">
                <span className="detail-label">M√©todo de pagamento:</span>
                <span className="detail-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</span>
              </div>
              <div className="detail-item">
                <span className="detail-label">Renova√ß√£o autom√°tica:</span>
                <span className="detail-value">Ativada</span>
              </div>
            </div>

            <div className="subscription-actions">
              <button onClick={handleManageSubscription} className="btn btn-primary">
                Gerenciar Assinatura
              </button>
              <button onClick={handleCancelSubscription} className="btn btn-danger">
                Cancelar Assinatura
              </button>
            </div>
          </div>
        </section>

        {/* Recursos inclu√≠dos */}
        <section className="subscription-section">
          <h2>‚ú® Recursos Inclu√≠dos</h2>
          <div className="features-grid">
            <div className="feature-item">
              <span className="feature-icon">ü§ñ</span>
              <div>
                <strong>54 Especialistas em IA</strong>
                <p>Acesso ilimitado a todos os agentes</p>
              </div>
            </div>
            <div className="feature-item">
              <span className="feature-icon">üí¨</span>
              <div>
                <strong>Serginho - Assistente Pessoal</strong>
                <p>Dispon√≠vel 24/7 para te ajudar</p>
              </div>
            </div>
            <div className="feature-item">
              <span className="feature-icon">üìö</span>
              <div>
                <strong>Study Lab Premium</strong>
                <p>Formata√ß√£o ABNT e ferramentas acad√™micas</p>
              </div>
            </div>
            <div className="feature-item">
              <span className="feature-icon">‚ö°</span>
              <div>
                <strong>Processamento Priorit√°rio</strong>
                <p>Respostas mais r√°pidas</p>
              </div>
            </div>
            <div className="feature-item">
              <span className="feature-icon">üíé</span>
              <div>
                <strong>Suporte Premium</strong>
                <p>Atendimento priorit√°rio</p>
              </div>
            </div>
            <div className="feature-item">
              <span className="feature-icon">üöÄ</span>
              <div>
                <strong>Recursos Ilimitados</strong>
                <p>Fair use policy</p>
              </div>
            </div>
          </div>
        </section>

        {/* Uso e estat√≠sticas */}
        <section className="subscription-section">
          <h2>üìä Uso Este M√™s</h2>
          <div className="usage-grid">
            <div className="usage-card">
              <div className="usage-icon">üí¨</div>
              <div className="usage-stats">
                <div className="usage-number">1,234</div>
                <div className="usage-label">Mensagens enviadas</div>
              </div>
            </div>
            <div className="usage-card">
              <div className="usage-icon">ü§ñ</div>
              <div className="usage-stats">
                <div className="usage-number">18</div>
                <div className="usage-label">Especialistas utilizados</div>
              </div>
            </div>
            <div className="usage-card">
              <div className="usage-icon">üìö</div>
              <div className="usage-stats">
                <div className="usage-number">7</div>
                <div className="usage-label">Documentos criados</div>
              </div>
            </div>
            <div className="usage-card">
              <div className="usage-icon">‚è±Ô∏è</div>
              <div className="usage-stats">
                <div className="usage-number">12h</div>
                <div className="usage-label">Tempo economizado</div>
              </div>
            </div>
          </div>
        </section>

        {/* Faturas */}
        <section className="subscription-section">
          <h2>üßæ Hist√≥rico de Faturas</h2>
          <div className="invoices-table">
            <div className="invoice-row invoice-header">
              <div>Data</div>
              <div>Descri√ß√£o</div>
              <div>Valor</div>
              <div>Status</div>
              <div>A√ß√£o</div>
            </div>
            <div className="invoice-row">
              <div>{new Date().toLocaleDateString("pt-BR")}</div>
              <div>Plano Premium - Mensal</div>
              <div>R$ 90,00</div>
              <div><span className="badge badge-paid">Pago</span></div>
              <div><a href="#" className="link">Baixar PDF</a></div>
            </div>
            <div className="invoice-row">
              <div>{new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toLocaleDateString("pt-BR")}</div>
              <div>Plano Premium - Mensal</div>
              <div>R$ 90,00</div>
              <div><span className="badge badge-paid">Pago</span></div>
              <div><a href="#" className="link">Baixar PDF</a></div>
            </div>
          </div>
        </section>

        {/* A√ß√µes r√°pidas */}
        <section className="subscription-section">
          <h2>‚ö° A√ß√µes R√°pidas</h2>
          <div className="quick-actions">
            <Link to="/agents" className="action-card">
              <span className="action-icon">üéØ</span>
              <div>
                <strong>Explorar Especialistas</strong>
                <p>Descubra todos os 54 agentes</p>
              </div>
            </Link>
            <Link to="/serginho" className="action-card">
              <span className="action-icon">üí¨</span>
              <div>
                <strong>Chat com Serginho</strong>
                <p>Converse com seu assistente</p>
              </div>
            </Link>
            <Link to="/study" className="action-card">
              <span className="action-icon">üìö</span>
              <div>
                <strong>Study Lab</strong>
                <p>Ferramentas acad√™micas</p>
              </div>
            </Link>
            <Link to="/settings" className="action-card">
              <span className="action-icon">‚öôÔ∏è</span>
              <div>
                <strong>Configura√ß√µes</strong>
                <p>Personalize sua experi√™ncia</p>
              </div>
            </Link>
          </div>
        </section>

        {/* Suporte */}
        <section className="subscription-section">
          <h2>‚ùì Precisa de Ajuda?</h2>
          <div className="support-card">
            <p>Nossa equipe de suporte est√° dispon√≠vel para te ajudar.</p>
            <div className="support-actions">
              <a href="mailto:suporte@kizirianmax.site" className="btn btn-secondary">
                üìß Enviar E-mail
              </a>
              <Link to="/help" className="btn btn-secondary">
                üìñ Central de Ajuda
              </Link>
            </div>
          </div>
        </section>
      </div>
    </div>
  );
}

